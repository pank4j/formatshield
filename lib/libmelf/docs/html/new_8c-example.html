<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Example Documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="examples.html">Examples</a> &nbsp; </center>
<hr><h1>new.c</h1>Generates a new ELF binary with a few different types of sections.<p>
<div class="fragment"><pre><span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>

<span class="preprocessor">#include "melf.h"</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
        <a name="_a0"></a><a class="code" href="struct__elf__spec__header.html">ELF_SPEC_HEADER</a> *curr;
        <a name="_a1"></a><a class="code" href="struct__melf.html">MELF</a> *melf = <a name="a2"></a><a class="code" href="group__melf.html#a3">melf_new</a>();

        <span class="keywordflow">if</span> (!melf)
                <span class="keywordflow">return</span> 0;

        fprintf(stdout, <span class="stringliteral">"creating new elf img called 'blank'...\n"</span>);

        <a name="a3"></a><a class="code" href="group__elfheader.html#a0">melf_elfSetType</a>(melf, ET_EXEC);
        <a name="a4"></a><a class="code" href="group__elfheader.html#a2">melf_elfSetMachine</a>(melf, EM_386);

        <span class="keywordflow">if</span> ((curr = <a name="a5"></a><a class="code" href="group__sections.html#a0">melf_sectionAdd</a>(melf)))
        {
                <a name="a6"></a><a class="code" href="group__sections.html#a9">melf_sectionSetName</a>(melf, curr, <span class="stringliteral">"test-section"</span>);
                <a name="a7"></a><a class="code" href="group__sections.html#a11">melf_sectionSetType</a>(melf, curr, SHT_NOBITS);
        }
        
        <span class="keywordflow">if</span> ((curr = <a class="code" href="group__sections.html#a0">melf_sectionAdd</a>(melf)))
        {
                <a class="code" href="group__sections.html#a9">melf_sectionSetName</a>(melf, curr, <span class="stringliteral">"bobby"</span>);
                <a class="code" href="group__sections.html#a11">melf_sectionSetType</a>(melf, curr, SHT_NOBITS);
        }

        <span class="comment">// Add a dynamic section</span>
        
        <span class="keywordflow">if</span> ((curr = <a name="a8"></a><a class="code" href="group__sect__dynamic.html#a0">melf_dynamicCreate</a>(melf)))
        {
                <a class="code" href="struct__elf__spec__header.html">ELF_SPEC_HEADER</a> *dynstr = <a name="a9"></a><a class="code" href="group__sections.html#a21">melf_sectionGetStringTableHeader</a>(melf, curr);
                <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> index = 0;

                <span class="comment">// Add DT_NEEDED for libc.</span>
                <span class="keywordflow">if</span> (dynstr)
                        index = <a name="a10"></a><a class="code" href="group__sect__strings.html#a1">melf_stringTableSetString</a>(melf, dynstr, <span class="stringliteral">"/lib/libc.so.6"</span>);

                <a name="a11"></a><a class="code" href="group__sect__dynamic.html#a1">melf_dynamicAddTag</a>(melf, curr, DT_NEEDED, index);
        }

        <span class="comment">// Add a note section</span>

        <span class="keywordflow">if</span> ((curr = <a name="a12"></a><a class="code" href="group__sect__note.html#a0">melf_noteCreate</a>(melf, <span class="stringliteral">".note"</span>, 1)))
        {
                <a name="a13"></a><a class="code" href="group__sect__note.html#a1">melf_noteAdd</a>(melf, curr, 1, <span class="stringliteral">"NAZI"</span>, <span class="stringliteral">"JONES"</span>, 6);
                <a class="code" href="group__sect__note.html#a1">melf_noteAdd</a>(melf, curr, 0, <span class="stringliteral">"NAME"</span>, <span class="stringliteral">"DESC"</span>, 5);
                <a class="code" href="group__sect__note.html#a1">melf_noteAdd</a>(melf, curr, 1, <span class="stringliteral">"JANE"</span>, <span class="stringliteral">"DESCZ"</span>, 5);
        }

        <span class="comment">// Add a symbol table</span>
        
        <span class="keywordflow">if</span> ((curr = <a name="a14"></a><a class="code" href="group__sect__symboltable.html#a0">melf_symbolTableCreate</a>(melf, <span class="stringliteral">".symtab"</span>)))
        {
                Elf32_Sym *sym = <a name="a15"></a><a class="code" href="group__sect__symboltable.html#a1">melf_symbolTableAddSymbol</a>(melf, curr, <span class="stringliteral">"tester"</span>);
                sym = <a class="code" href="group__sect__symboltable.html#a1">melf_symbolTableAddSymbol</a>(melf, curr, <span class="stringliteral">"shutup"</span>);

                <a name="a16"></a><a class="code" href="group__sect__symbols.html#a8">melf_symbolSetType</a>(melf, curr, sym, STT_OBJECT);
                <a name="a17"></a><a class="code" href="group__sect__symbols.html#a6">melf_symbolSetBinding</a>(melf, curr, sym, STB_GLOBAL);
        }

        <a name="a18"></a><a class="code" href="group__melf.html#a6">melf_save</a>(melf, <span class="stringliteral">"blank"</span>);

        <a name="a19"></a><a class="code" href="group__melf.html#a5">melf_destroy</a>(melf);

        <span class="keywordflow">return</span> 1;
}
</pre></div><hr><address style="align: right;"><small>Generated on Tue Jun 3 00:01:35 2003 for libmelf by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
